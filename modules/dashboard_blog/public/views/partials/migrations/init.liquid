{% query_graph 'modules/dashboard_blog/get_blog_instance' %}
{% if g.customizations.results == blank %}
  {% parse_json 'blog_instance' %}
    {
      "custom_model_type_name": "modules/dashboard_blog/blog_instance",
      "properties": [
        { "name": "title", "value": "PlatformOS Blog" },
        { "name": "subtitle", "value": "" } ,
        { "name": "enabled", "value": "true" },
        { "name": "slug", "value": "blog" },
        { "name": "scope", "value": "blog" },
        { "name": "sidebar_enabled", "value": "true" },
        { "name": "tags_filter", "value": "platformOS, Getting Started" },
        { "name": "grid_view_enabled", "value": "true" }
      ]
    }
  {% endparse_json %}
  {% execute_query 'modules/dashboard_blog/migration_create_customization', data: blog_instance %}

  {% assign image_url = 'modules/dashboard_blog/images/hero.jpg' | asset_url %}
  {% execute_query 'modules/dashboard_blog/create_image', result_name: "in", image_type: "header_image", owner_id: g.customization_create.id, raw_url: image_url %}

  {% parse_json 'blog_post' %}
  {
    "custom_model_type_name": "modules/dashboard_blog/blog_post",
    "properties": [
      { "name": "slug", "value": "getting-started-with-the-platformos-blog-module" },
      { "name": "title", "value": "Getting Started with the platformOS Blog Module" },
      { "name": "tags", "value": "getting started" },
      { "name": "content", "value": "<p>In this short introduction, we will guide you through some basic blog features so that you can kickstart your blog in a matter of minutes.&nbsp; As an administrator of your blog, follow the steps below to set up your blog and start creating content. <span></span></p><br><h1>Create an administrator account <br>\r\n</h1><ol>\r\n</ol>\r\n<p><span>To start working on your blog, you should set up an administrator account and delete the default administrator account to secure it:<br></span></p>\r\n<ol>\r\n</ol>\r\n<ol>\r\n<li>\r\n<span>Go to <em>http://[your-page-url]/sign-up</em> and create a new user.</span><span> <br>Once done, you are redirected to the <em>/log-in</em> page with the message: \"Your account has been successfully created. Please log in.\"</span><br>\r\n</li>\r\n<li>\r\n<span>As your new account does not have access to the Dashboard yet, first log in as the auto-generated administrative account with the email \"<strong>admin@example.com</strong>\" and password \"<strong>admin1234</strong>\".</span><span> <br>You are now on the Dashboard, where you should see a list of all registered users. </span><br>\r\n</li>\r\n<li><span>Click on Edit next to the user you've created, and select the Admin checkbox. Click on the Save button to save your changes.<br></span></li>\r\n<li><span>Log in as the user you created, and remove the default admin user in order to secure your blog.<br><br></span></li>\r\n</ol>\r\n<h1>Set up the blog</h1><p>Follow these steps to set up some basic information for your blog, like its title, layout, and social sharing settings:<br></p><ol>\r\n<li>\r\n<span>Go to the Dashboard, and click on the Blog link in the left navigation. </span><br>\r\n</li>\r\n<li><span>You can see three links at the top of the page, click on Blog Settings. <br></span></li>\r\n<li>\r\n<span>Adjust your blog's default settings. The following configuration options are available: <br></span>\r\n</li>\r\n</ol><span></span><ul>\r\n<li>\r\n<span>Title: the title of your blog displayed on the top left</span><br>\r\n</li>\r\n<li>\r\n<span>Subtitle: the subtitle displayed below the title</span><br>\r\n</li>\r\n<li>\r\n<span>Sidebar enabled: enables right sidebar column with tags and social media integration</span><br>\r\n</li>\r\n<li>\r\n<span>Grid view enabled: changes the alignment of the post list</span><br>\r\n</li>\r\n<li>\r\n<span>Tags filter: allows you to set tags that will later be available to add to your posts and used for search on the main page</span><br>\r\n</li>\r\n<li>\r\n<span>Facebook app id: ID generated by Facebook to connect to Facebook</span><br>\r\n</li>\r\n<li>\r\n<span>Image: hero image of your blog</span><br>\r\n</li>\r\n<li>\r\n<span>Social media links: social media links displayed in the sidebar</span><strong><br>\r\n</strong>\r\n</li>\r\n<br>\r\n</ul><h1>Create your first post</h1><p>Follow these steps to create your first post:</p><ol>\r\n<li>\r\n<span>Click the New Post link on the top of the Blog section.</span><br>\r\n</li>\r\n<li>\r\n<span>Fill in the form. Make sure you select Publish Now, otherwise your post will not be visible to the public.&nbsp;</span><br>\r\n</li>\r\n<li>\r\n<span>Click on Save.</span><br>\r\n</li>\r\n</ol><p><span>You have created your first post. You can now delete or unpublish the \"Getting Started with the platformOS Blog Module\" post so that it is no longer displayed on your blog.&nbsp;</span></p>\r\n<ol>\r\n</ol>\r\n<p><strong><span><span><br></span></span></strong></p><p><strong><font color=\"green\">Congratulations, you have now set up your platformOS Blog.</font></strong></p>\r\n<ol>\r\n</ol><br>" },
      { "name": "excerpt", "value": "Thank you for installing the platformOS Blog Module. In this sample blog post, you will learn how to set up your blog and how to create new content." },
      { "name": "author_name", "value": "platformOS Team" },
      { "name": "author_biography", "value": "Creators of the platformOS Blog Module" },
      { "name": "published_at", "value": "2019-04-03T00:00:00.000Z" },
      { "name": "blog_instance_id", "value": "{{ g.customization_create.id }}" }
    ]
  }
  {% endparse_json %}
  {% execute_query 'modules/dashboard_blog/migration_create_customization', data: blog_post %}

  {% assign image_url = 'modules/dashboard_blog/images/first_post_image.jpg' | asset_url %}
  {% log image_url, type: "Image Url" %}
  {% execute_query 'modules/dashboard_blog/create_image', result_name: "i", image_type: "hero_image", owner_id: g.customization_create.id, raw_url: image_url %}

  {% assign image_url = 'modules/dashboard_blog/images/thumb_pOS.jpg' | asset_url %}
  {% execute_query 'modules/dashboard_blog/create_image', result_name: "i", image_type: "author_avatar", owner_id: g.customization_create.id, raw_url: image_url %}
{% endif %}
